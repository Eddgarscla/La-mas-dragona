<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Episodio - La M√°s Draga</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      background-image: url('WhatsApp Image 2025-12-01 at 07.24.11.jpeg');
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center top;
      color: white;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }
   @keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.challengeText {
  text-align: center;
  margin: 4px 0;
  opacity: 0;
  animation: fadeInUp 0.4s ease-out forwards;
}

.challengeName {
  font-size: 1.2rem;
  font-weight: 600;
}

    .sim-panel {
      max-width: 430px;
      margin: 0 auto; /* ya no necesitamos espacio arriba */
      padding: 18px 18px 24px;
      background: rgba(0, 0, 0, 0.40);
      border-radius: 26px;
      backdrop-filter: blur(18px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.75);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 2.0rem;
      text-align: center;
      line-height: 1.2;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      background: linear-gradient(90deg, #ffd700, #ff69b4, #7b5dff);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
    }

    #episodeSubtitle {
      margin: 0 0 14px;
      text-align: center;
      font-size: 0.95rem;
      opacity: 0.9;
    }

    h2.sectionTitle {
      margin: 14px 0 8px;
      font-size: 1.15rem;
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      text-shadow:
        0 0 8px rgba(0,0,0,0.9),
        0 0 16px rgba(255,105,180,0.9);
    }

    h3.miniTitle {
      margin: 12px 0 6px;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .episodeRow {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 0;
      margin-bottom: 4px;
      background: transparent;
      border-radius: 0;
      backdrop-filter: none;
      box-shadow: none;
      border-left: none;
    }

    .perfGroup {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .episodeRow img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 105, 180, 0.9);
      box-shadow: 0 0 10px rgba(255,105,180,0.9);
      flex-shrink: 0;
    }
    .bigPerfList {
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-top: 8px;
}

.bigPerfCard {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 10px 0 4px;
}

.bigPerfCard img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ff69b4;
  box-shadow: 0 0 14px rgba(255,105,180,0.9);
}

.bigPerfName {
  margin-top: 6px;
  font-size: 0.95rem;
  font-weight: 600;
}

.bigPerfText {
  font-size: 0.8rem;
  opacity: 0.9;
}

    .episodeText {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .episodeName {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .episodePerf {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .perf-excellent   { border-left-color: #00ff9d; }
    .perf-good        { border-left-color: #5dd9ff; }
    .perf-bad         { border-left-color: #ffd54a; }
    .perf-awful       { border-left-color: #ff3b6b; }

    .perfGrid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px 12px;
    }

    .perfCard {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 8px 8px 10px;
      border-radius: 18px;
      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 14px rgba(0,0,0,0.7);
      max-width: 120px;
    }

    .perfCard img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #ff69b4;
      box-shadow: 0 0 12px rgba(255,105,180,0.9);
      margin-bottom: 4px;
    }

    .perfCard.perf-excellent img {
      border-color: #00ff9d;
      box-shadow: 0 0 14px rgba(0,255,157,0.9);
    }

    .perfCard.perf-good img {
      border-color: #5dd9ff;
      box-shadow: 0 0 14px rgba(93,217,255,0.9);
    }

    .perfCard.perf-bad img {
      border-color: #ffd54a;
      box-shadow: 0 0 14px rgba(255,213,74,0.9);
    }

    .perfCard.perf-awful img {
      border-color: #ff3b6b;
      box-shadow: 0 0 14px rgba(255,59,107,0.9);
    }

    .winnerCard {
      text-align: center;
      padding-top: 10px;
    }

    .winnerCard img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.9);
      margin-bottom: 10px;
    }

    .winnerTitle {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 4px;
    }

    .runnerUpsWrapper {
  margin-top: 12px;
  text-align: center;
}

.runnerUpsTitle {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 6px;
}

.runnerUpsGrid {
  display: flex;
  justify-content: center;
  gap: 14px;
}

.runnerUpCard {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.runnerUpCard img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ffd700;
  box-shadow: 0 0 12px rgba(255,215,0,0.8);
}

.runnerUpName {
  margin-top: 4px;
  font-size: 0.8rem;
}

    .lipSyncGrid {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 16px;
  margin-top: 10px;
}

.lipSyncRow {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  background: transparent;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
}

.lipSyncRow img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ff69b4;
  box-shadow: 0 0 14px rgba(255,105,180,0.9);
}
    .topBottomGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3 arriba, 3 abajo */
  gap: 16px 10px;
  margin-top: 10px;
}

.topBottomCard {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.topBottomCard img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ff69b4;
  box-shadow: 0 0 14px rgba(255,105,180,0.9);
}

.topBottomName {
  margin-top: 6px;
  font-size: 0.85rem;
  font-weight: 600;
}

    .eliminationWrapper {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 6px;
    }

    .safeQueen, .outQueen {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .safeQueen img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #00ff9d;
      box-shadow: 0 0 18px rgba(0,255,157,0.9);
    }

    .outQueen img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ff0037;
      box-shadow: 0 0 18px rgba(255,0,55,0.9);
      filter: grayscale(100%);
    }

    .outLabel {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #ff8fa8;
    }

    #nextBtn {
      font-size: 1.1em;
      padding: 12px 20px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      background: linear-gradient(135deg, #ff37b3, #ff70d6);
      color: white;
      font-weight: bold;
      text-shadow: 0 0 8px rgba(255,255,255,0.8);
      box-shadow: 0 0 18px rgba(255, 20, 147, 0.85),
                  0 0 38px rgba(255, 20, 147, 0.6);
      transition: transform 0.18s ease, box-shadow 0.2s ease, opacity 0.2s;
      backdrop-filter: blur(6px);
      margin: 18px auto 0;
      display: block;
      width: 80%;
      max-width: 260px;
    }

    #nextBtn:hover {
      transform: scale(1.04);
      box-shadow: 0 0 28px rgba(255, 20, 147, 1),
                  0 0 60px rgba(255, 20, 147, 0.8);
    }

    #nextBtn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    #episodeContent {
      margin-top: 4px;
    }
    .top-align {
  align-self: flex-start !important;
  margin-top: 20px !important;
}
    .savedQueensMessage {
  margin: 14px auto 10px;
  text-align: center;
  font-size: 1.05rem;
  max-width: 300px;
  line-height: 1.25;
  background: rgba(0,0,0,0.35);
  padding: 8px 12px;
  border-radius: 16px;
  backdrop-filter: blur(10px);
  box-shadow: 0 0 20px rgba(255, 20, 147, 0.6),
              0 0 35px rgba(255, 105, 180, 0.4);
  color: #ffd8ff;
  text-shadow: 0 0 6px rgba(255, 255, 255, 0.85),
               0 0 14px rgba(255, 105, 180, 0.9);
}

.savedQueensMessage strong {
  font-weight: 600;
  color: #fff;
}

.savedSubtitle {
  font-size: 0.85rem;
  opacity: 0.9;
  margin-top: 4px;
}
  </style>
</head>
<body>
  <div class="sim-panel">
    <h1 id="episodeTitle"></h1>
    <p id="episodeSubtitle"></p>

    <div id="episodeContent"></div>

    <button id="nextBtn">La m√°s‚Ä¶</button>
  </div>

  <script>
    // =========================
    //   RETOS POR TEMPORADA
    // =========================
    const challengesBySeason = {
      "1": ["La m√°s diva","La m√°s quincea√±era","La m√°s Thal√≠a","La m√°s Alebrije","La m√°s dram√°tica"],
      "2": ["La m√°s t√≠pica","La m√°s religiosa","La m√°s luchona","La m√°s pi√±ata","La m√°s Juanga","La m√°s independiente","La m√°s villana"],
      "3": ["La m√°s suertuda","La m√°s prehisp√°nica","La m√°s fichera","La m√°s Chespirito","La m√°s famosa","La m√°s legendaria","La m√°s bella se√±orita M√©xico","La m√°s buchona","La m√°s antojable"],
      "4": ["La m√°s folcl√≥rica","La m√°s pintada","La m√°s revolucionaria","La m√°s mezclilla","La m√°s cachuda","La m√°s famosa","La m√°s rosa mexicano","La m√°s chola","La m√°s Cri Cri","La m√°s imperial"],
      "5": ["La m√°s artesanal","La m√°s a color","La m√°s juguete","La m√°s famosa","La m√°s del Toro","La m√°s tejocote","La m√°s futurista","La m√°s Lele","La m√°s monja coronada"],
      "6": ["La m√°s monumental","La m√°s Frida","La m√°s Pixar","La m√°s recursiva","La m√°s floral","La m√°s nahual","La m√°s azul peltre","La m√°s animada","La m√°s divina Infantita","La m√°s galardonada"],
      "7": ["La m√°s Guelaguetza","La m√°s Silvia Pinal","La m√°s dulce","La m√°s recursiva","La m√°s metrera","La m√°s plicop√∫rpura","La m√°s panzuda","La m√°s ma√≠z","La m√°s Lupita"]
    };

    const specialChallenges = {
      reunion: "D√≠a de Muertas",
    };

    const allChallenges = [];
    for (const season in challengesBySeason) {
      challengesBySeason[season].forEach((name, index) => {
        allChallenges.push({
          id: `T${season}-${index + 1}`,
          name,
          season
        });
      });
    }
    allChallenges.push(
      { id: "SPECIAL-reunion", name: specialChallenges.reunion, season: "all", type: "reunion" },
    );

    const usedChallengeIds = [];

    function getRandomChallenge() {
      const disponibles = allChallenges.filter(ch => !usedChallengeIds.includes(ch.id));
      if (!disponibles.length) return null;
      const randomIndex = Math.floor(Math.random() * disponibles.length);
      const reto = disponibles[randomIndex];
      usedChallengeIds.push(reto.id);
      return reto;
    }

    // =========================
    //   DATOS DEL CAST
    // =========================
    const cast   = JSON.parse(localStorage.getItem("lmd_selectedQueens") || "[]");
    const config = JSON.parse(localStorage.getItem("lmd_seasonConfig") || "{}");

    let aliveQueens = cast.slice();
    const trackRecord = {};
    let episodeNumber = 1;

    const episodeTitleEl    = document.getElementById("episodeTitle");
    const episodeSubtitleEl = document.getElementById("episodeSubtitle");
    const episodeContentEl  = document.getElementById("episodeContent");
    const nextBtn           = document.getElementById("nextBtn");

    if (!cast.length) {
      episodeTitleEl.textContent = "No hay cast cargado";
      episodeSubtitleEl.textContent = "Vuelve a la pantalla inicial y selecciona tus femininosas ‚ú®";
      episodeContentEl.textContent = "";
      nextBtn.disabled = true;
    }

    const performanceLabels = {
      excellent: "tuvo un excelente desempe√±o",
      good:      "tuvo un buen desempe√±o",
      bad:       "tuvo un mal desempe√±o",
      awful:     "tuvo un p√©simo desempe√±o"
    };

    let currentEpisode = null;
    // -1 -> suspense / 0 -> desempe√±o / 1 -> top & bottom / 2 -> winner / 3 -> lipsync / 4 -> eliminaci√≥n / 5 -> track / 6 -> final
    let step = -1;
   let hasShownPerformance = false; // controla si ya mostramos el desempe√±o

    // =========================
    //   CONSTRUIR EPISODIO
    // =========================
    function buildEpisode() {
      const challenge = getRandomChallenge() || { id: "fallback", name: "La Gran Final" };

      const shuffled = aliveQueens.slice().sort(() => Math.random() - 0.5);
      const n = shuffled.length;
      if (n === 0) return;

      const indexes = [...Array(n).keys()];

      function drawIndex() {
        const pos = Math.floor(Math.random() * indexes.length);
        return indexes.splice(pos, 1)[0];
      }

      const winnerIdx = drawIndex();

      const topIdxs = [];
      if (n >= 4) topIdxs.push(drawIndex());
      if (n >= 5) topIdxs.push(drawIndex());

      const lipIdxs = [];
      if (n >= 3) lipIdxs.push(drawIndex());
      if (n >= 4) lipIdxs.push(drawIndex());

      let extraBottomIdx = null;
      if (n >= 6 && indexes.length > 0) {
        extraBottomIdx = drawIndex();
      }

      const lowIdxs = [];
      if (indexes.length > 0) {
        const numLow = Math.min(2, indexes.length);
        for (let i = 0; i < numLow; i++) {
          lowIdxs.push(drawIndex());
        }
      }

      const performances = [];

      for (let i = 0; i < n; i++) {
        const q = shuffled[i];
        let perfType = "good";
        let trackMark = "Salvada";

        if (i === winnerIdx) {
          perfType  = "excellent";
          trackMark = "La +";
        } else if (topIdxs.includes(i)) {
          perfType  = "good";
          trackMark = "La casi +";
        } else if (lipIdxs.includes(i)) {
          perfType  = "awful";
          trackMark = "La -";
        } else if (i === extraBottomIdx || lowIdxs.includes(i)) {
          perfType  = "bad";
          trackMark = "La casi -";
        } else {
          perfType  = "good";
          trackMark = "Salvada";
        }

        performances.push({
          queen: q,
          type: perfType,
          text: performanceLabels[perfType],
          track: trackMark
        });

        if (!trackRecord[q.name]) {
          trackRecord[q.name] = [];
        }
        trackRecord[q.name].push(trackMark);
      }

      const tops = [shuffled[winnerIdx], ...topIdxs.map(i => shuffled[i])];
      const bottoms = [...lipIdxs.map(i => shuffled[i])];
      if (extraBottomIdx !== null) bottoms.push(shuffled[extraBottomIdx]);

      const lipsyncPair = lipIdxs.map(i => shuffled[i]);
      let eliminated = null, safeFromLipsync = null;

      if (lipsyncPair.length === 2) {
        eliminated = Math.random() < 0.5 ? lipsyncPair[0] : lipsyncPair[1];
        safeFromLipsync = eliminated === lipsyncPair[0] ? lipsyncPair[1] : lipsyncPair[0];
      } else if (lipsyncPair.length === 1) {
        eliminated = lipsyncPair[0];
        safeFromLipsync = null;
      }

      currentEpisode = {
        challenge,
        performances,
        tops,
        bottoms,
        winner: shuffled[winnerIdx],
        lipsyncPair,
        eliminated,
        safeFromLipsync
      };
    }

    // =========================
    //   RENDERS
    // =========================
    function renderPerformanceList() {
  episodeContentEl.innerHTML = "";

  const title = document.createElement("h2");
  title.className = "sectionTitle";
  title.textContent = "Desempe√±o del cast";
  episodeContentEl.appendChild(title);

  // Contenedor de todas las feminosas
  const list = document.createElement("div");
  list.className = "bigPerfList";

  currentEpisode.performances.forEach(item => {
    const card = document.createElement("div");
    card.className = `bigPerfCard perf-${item.type}`;

    card.innerHTML = `
      <img src="${item.queen.image}" alt="${item.queen.name}">
      <div class="bigPerfName">${item.queen.name}</div>
      <div class="bigPerfText">${item.text}</div>
    `;

    list.appendChild(card);
  });

  episodeContentEl.appendChild(list);
}

    function renderTopBottom() {
  episodeContentEl.innerHTML = "";
     

  // T√≠tulo general
  const title = document.createElement("h2");
  title.className = "sectionTitle";
  title.textContent = "Las m√°s y las menos";
  episodeContentEl.appendChild(title);

  const grid = document.createElement("div");
  grid.className = "topBottomGrid";

  // Juntamos tops y bottoms y los mezclamos para el drama
  const combined = [...currentEpisode.tops, ...currentEpisode.bottoms];

  // Quitamos duplicados por nombre (por si alguna est√° en ambos arrays)
  const seen = new Set();
  const unique = [];
  combined.forEach(q => {
    if (!seen.has(q.name)) {
      seen.add(q.name);
      unique.push(q);
    }
  });

  // Mezclar aleatoriamente
  unique.sort(() => Math.random() - 0.5);

  // Nos quedamos con m√°ximo 6
  const selected = unique.slice(0, Math.min(6, unique.length));

  selected.forEach(q => {
    const card = document.createElement("div");
    card.className = "topBottomCard";

    // Para el texto de debajo (mejores / peores) seg√∫n de d√≥nde venga
    const isTop = currentEpisode.tops.some(t => t.name === q.name);
    const isBottom = currentEpisode.bottoms.some(b => b.name === q.name);

    let tag = "";
    if (isTop && isBottom) {
      tag = "Drama total del episodio";
    } else if (isTop) {
      tag = "Entre las mejores del episodio";
    } else if (isBottom) {
      tag = "Entre las peores del episodio";
    }

    card.innerHTML = `
  <img src="${q.image}" alt="${q.name}">
  <div class="topBottomName">${q.name}</div>
`;

    grid.appendChild(card);
  });

  episodeContentEl.appendChild(grid);

        // ‚û§ Mostrar salvadas con estilo glam ‚ú®
  const saved = aliveQueens.filter(q =>
    !selected.some(s => s.name === q.name)
  );

  if (saved.length > 0) {
    const savedDiv = document.createElement("div");
    savedDiv.className = "savedQueensMessage";

    const names = saved.map(q => q.name).join(" ¬∑ ");

    savedDiv.innerHTML = `
      <p><strong>${names}</strong></p>
      <p class="savedSubtitle">est√°n salvadas</p>
    `;
    
    episodeContentEl.appendChild(savedDiv);
  }
}

    function renderWinner() {
  episodeContentEl.innerHTML = "";

  const retoNombre = currentEpisode.challenge.name;
  let clean = retoNombre.replace(/^La m√°s\s*/i, "");
  if (!clean) clean = retoNombre;

  // T√≠tulo grande arriba con "es:"
  episodeTitleEl.textContent = `La m√°s ${clean} es:`;
  episodeSubtitleEl.textContent = "";

  // Tarjeta de la ganadora del episodio
  const card = document.createElement("div");
  card.className = "winnerCard";

  card.innerHTML = `
    <img src="${currentEpisode.winner.image}" alt="${currentEpisode.winner.name}">
    <div class="episodeName">${currentEpisode.winner.name}</div>
  `; // üëà sin (T2)

  episodeContentEl.appendChild(card);

  // ===== Casi la m√°s (top 2 sin la ganadora) =====
  const runnerUps = currentEpisode.tops
    .filter(q => q.name !== currentEpisode.winner.name)
    .slice(0, 2); // solo dos

  if (runnerUps.length > 0) {
    const wrap = document.createElement("div");
    wrap.className = "runnerUpsWrapper";

    const title = document.createElement("div");
    title.className = "runnerUpsTitle";
    title.textContent = "Casi la m√°s‚Ä¶";
    wrap.appendChild(title);

    const grid = document.createElement("div");
    grid.className = "runnerUpsGrid";

    runnerUps.forEach(q => {
      const c = document.createElement("div");
      c.className = "runnerUpCard";
      c.innerHTML = `
        <img src="${q.image}" alt="${q.name}">
        <div class="runnerUpName">${q.name}</div>
      `;
      grid.appendChild(c);
    });

    wrap.appendChild(grid);
    episodeContentEl.appendChild(wrap);
  }
}

    function renderLipsync() {
  episodeContentEl.innerHTML = "";

  // T√≠tulo dentro del panel
  const title = document.createElement("h2");
  title.className = "sectionTitle";
  title.textContent = "Las menos del reto son:";
  episodeContentEl.appendChild(title);

  const grid = document.createElement("div");
  grid.className = "lipSyncGrid";

  // Usamos todas las bottoms (no solo las que doblan)
  // y deduplicamos por si acaso
  const seen = new Set();
  const bottoms = [];
  currentEpisode.bottoms.forEach(q => {
    if (!seen.has(q.name)) {
      seen.add(q.name);
      bottoms.push(q);
    }
  });

  bottoms.forEach(q => {
    const isLip = currentEpisode.lipsyncPair.some(l => l.name === q.name);

    const row = document.createElement("div");
    row.className = "lipSyncRow";
    row.innerHTML = `
      <img src="${q.image}" alt="${q.name}">
      <div class="episodeName">${q.name}</div>
      <div class="episodePerf">
        ${isLip ? "Doblaje de eliminaci√≥n" : "Est√° salvada"}
      </div>
    `;
    grid.appendChild(row);
  });

  episodeContentEl.appendChild(grid);
}

    function renderElimination() {
      episodeContentEl.innerHTML = "";

      const title = document.createElement("h2");
      title.className = "sectionTitle";
      title.textContent = "Resultado del doblaje";
      episodeContentEl.appendChild(title);

      const wrap = document.createElement("div");
      wrap.className = "eliminationWrapper";

      const safe = document.createElement("div");
      safe.className = "safeQueen";
      safe.innerHTML = `
        <img src="${currentEpisode.safeFromLipsync.image}" alt="${currentEpisode.safeFromLipsync.name}">
        <div class="episodeName">${currentEpisode.safeFromLipsync.name} (T${currentEpisode.safeFromLipsync.season})</div>
        <div class="episodePerf">Sigue en la competencia</div>
      `;

      const out = document.createElement("div");
      out.className = "outQueen";
      out.innerHTML = `
        <img src="${currentEpisode.eliminated.image}" alt="${currentEpisode.eliminated.name}">
        <div class="outLabel">Abandona la competencia</div>
        <div class="episodeName">${currentEpisode.eliminated.name} (T${currentEpisode.eliminated.season})</div>
      `;

      wrap.appendChild(safe);
      wrap.appendChild(out);
      episodeContentEl.appendChild(wrap);
    }

    function renderTrackRecord() {
      episodeContentEl.innerHTML = "";

      const title = document.createElement("h2");
      title.className = "sectionTitle";
      title.textContent = "Track record de la temporada";
      episodeContentEl.appendChild(title);

      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.justifyContent = "space-between";
      header.style.fontSize = "0.8rem";
      header.style.opacity = "0.9";
      header.style.marginBottom = "6px";
      header.innerHTML = `
        <span>Feminosa</span>
        <span>Episodio ${episodeNumber}</span>
      `;
      episodeContentEl.appendChild(header);

      const table = document.createElement("div");
      table.style.display = "flex";
      table.style.flexDirection = "column";
      table.style.gap = "6px";

      cast.forEach(q => {
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.alignItems = "center";
        row.style.gap = "8px";

        const marks = trackRecord[q.name] || [];
        const mark = marks[episodeNumber - 1] || "‚Äî";

        row.innerHTML = `
          <img src="${q.image}" alt="${q.name}" style="
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ff69b4;
            box-shadow: 0 0 8px rgba(255,105,180,0.8);
          ">
          <span style="flex:1;font-size:0.85rem;">${q.name}</span>
          <span style="
            min-width: 90px;
            text-align: center;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(0,0,0,0.55);
            box-shadow: 0 0 10px rgba(0,0,0,0.7);
          ">
            ${mark}
          </span>
        `;
        table.appendChild(row);
      });

      episodeContentEl.appendChild(table);
    }

    // =========================
    //   FINAL
    // =========================
    function startFinale() {
      episodeTitleEl.textContent = "La Gran Final";
      episodeSubtitleEl.textContent = "Ganadora de la temporada";

      const finalists = aliveQueens.slice();
      const winner = finalists[Math.floor(Math.random() * finalists.length)];

      episodeContentEl.innerHTML = `
        <div class="winnerCard">
          <div class="winnerTitle">¬°La m√°s ganadora es‚Ä¶!</div>
          <img src="${winner.image}" alt="${winner.name}">
          <div class="episodeName">${winner.name} (T${winner.season})</div>
        </div>
      `;

      nextBtn.textContent = "Fin de la simulaci√≥n";
      nextBtn.disabled = true;
    }

    // =========================
    //   CONTROL DE PASOS
    // =========================
    function renderStep() {
      // Pantalla inicial de suspense NO necesita currentEpisode
      if (step === -1) {
        episodeTitleEl.textContent = "La m√°s‚Ä¶";
        episodeSubtitleEl.textContent = "Pulsa para revelar el reto del episodio";
        nextBtn.textContent = "Revelar reto";
        episodeContentEl.innerHTML = "";
        return;
      }

      if (!currentEpisode) return;

      const retoNombre = currentEpisode.challenge.name;

      switch (step) {
        case 0:
  episodeTitleEl.textContent = retoNombre;

  if (!hasShownPerformance) {
    // PRIMERA VEZ EN EL PASO 0: mostrar solo el reto
    episodeSubtitleEl.textContent = "Reto del episodio";
    nextBtn.textContent = "Mostrar desempe√±o";

    episodeContentEl.innerHTML = `
      <p class="challengeText">Las feminos√°s se enfrentan al reto:</p>
      <p class="challengeText challengeName">${retoNombre}</p>
    `;
  } else {
    // SEGUNDA VEZ EN EL PASO 0: mostrar el desempe√±o como antes
    episodeSubtitleEl.textContent = "Desempe√±o del episodio";
    nextBtn.textContent = "Las m√°s y las menos";
    renderPerformanceList();

    document.querySelector(".sim-panel").classList.add("top-align");
  }
  break;

        case 1:
          episodeTitleEl.textContent = retoNombre;
          episodeSubtitleEl.textContent = "Las m√°s y las menos del reto";
          nextBtn.textContent = "Revelar a la m√°s‚Ä¶";
          renderTopBottom();
          break;

        case 2:
          nextBtn.textContent = "Ver lip sync";
          renderWinner();
          break;

        case 3:
  episodeTitleEl.textContent = retoNombre;
  episodeSubtitleEl.textContent = "Reto de doblaje";
  nextBtn.textContent = "Resultado del doblaje";

  document.querySelector(".sim-panel").classList.remove("top-align");
          
  renderLipsync();
  break;

        case 4:
          episodeTitleEl.textContent = retoNombre;
          episodeSubtitleEl.textContent = "";
          nextBtn.textContent = "Track record";
          renderElimination();
          break;

        case 5:
          episodeTitleEl.textContent = "Track record de la temporada";
          episodeSubtitleEl.textContent = "Resumen hasta este episodio";
          nextBtn.textContent = aliveQueens.length > 4
            ? "Siguiente episodio"
            : "Ir a la Gran Final";
          renderTrackRecord();
          break;

        case 6:
          startFinale();
          break;
      }
    }

    // =========================
    //   CLICK DEL BOT√ìN
    // =========================
    nextBtn.addEventListener("click", () => {
      if (!cast.length) return;
      if (nextBtn.disabled) return;

      // Primer click: construir episodio
if (step === -1) {
  hasShownPerformance = false; // siempre empezar desde el reto
  buildEpisode();
  step = 0;
  renderStep();
  return;
}

      // Despu√©s de eliminaci√≥n: sacar a la eliminada de aliveQueens
      if (step === 4 && currentEpisode && currentEpisode.eliminated) {
        aliveQueens = aliveQueens.filter(q => q.name !== currentEpisode.eliminated.name);
      }

      // Despu√©s del track record
if (step === 5) {
  if (aliveQueens.length > 4) {
    hasShownPerformance = false; // reset para el nuevo episodio
    episodeNumber++;
    buildEpisode();
    step = -1;
    renderStep();
    return;
  } else {
    step = 6; // Final
    renderStep();
    return;
  }
}

     // Flujo normal (0 ‚Üí 5)
if (step >= 0 && step < 5) {

  // En el paso 0, primero mostramos SOLO el reto
  // y en el siguiente click mostramos el desempe√±o
  if (step === 0 && !hasShownPerformance) {
    hasShownPerformance = true;
    renderStep(); // actualiza la vista sin cambiar de paso
    return;
  }

  step++;
  renderStep();
}
}); // ‚¨ÖÔ∏è Cierra el nextBtn.addEventListener      
    // Mostrar pantalla inicial
    if (cast.length) {
      renderStep();
    }
  </script>
</body>
</html>
