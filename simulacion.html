<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Episodio - La M√°s Draga</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      background-image: url('WhatsApp Image 2025-12-01 at 07.24.11.jpeg');
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center top;
      color: white;
      overflow-x: hidden;
      padding: env(safe-area-inset-top) 10px 30px;
      box-sizing: border-box;
    }

    /* Panel principal encima de la pasarela */
    .sim-panel {
      max-width: 430px;
      margin: 70px auto 40px;
      padding: 18px 18px 24px;
      background: rgba(0, 0, 0, 0.40);
      border-radius: 26px;
      backdrop-filter: blur(18px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.75);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 2.0rem;
      text-align: center;
      line-height: 1.2;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      background: linear-gradient(90deg, #ffd700, #ff69b4, #7b5dff);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
    }

    #episodeSubtitle {
      margin: 0 0 14px;
      text-align: center;
      font-size: 0.95rem;
      opacity: 0.9;
    }

    h2.sectionTitle {
      margin: 14px 0 8px;
      font-size: 1.15rem;
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      text-shadow:
        0 0 8px rgba(0,0,0,0.9),
        0 0 16px rgba(255,105,180,0.9);
    }

    h3.miniTitle {
      margin: 12px 0 6px;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* Fila gen√©rica de episodio (reina + texto) */
    /* Fila gen√©rica de episodio (reina + texto) */
.episodeRow {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  margin-bottom: 4px;
  background: transparent;          /* ‚ùå sin barra negra */
  border-radius: 0;
  backdrop-filter: none;
  box-shadow: none;
  border-left: none;
}

.perfGroup {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 10px;
}

    .episodeRow img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 105, 180, 0.9);
      box-shadow: 0 0 10px rgba(255,105,180,0.9);
      flex-shrink: 0;
    }

    .episodeText {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .episodeName {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .episodePerf {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    /* Colores seg√∫n desempe√±o */
    .perf-excellent   { border-left-color: #00ff9d; }
    .perf-good        { border-left-color: #5dd9ff; }
    .perf-bad         { border-left-color: #ffd54a; }
    .perf-awful       { border-left-color: #ff3b6b; }
    }
    /* Grupos de desempe√±o (bloques como en tu ejemplo) */
.perfGroup {
  margin-bottom: 18px;
}

.perfGrid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 14px 12px;
}

.perfCard {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 8px 8px 10px;
  border-radius: 18px;
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 14px rgba(0,0,0,0.7);
  max-width: 120px;
}

/* Foto dentro de la card */
.perfCard img {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ff69b4;
  box-shadow: 0 0 12px rgba(255,105,180,0.9);
  margin-bottom: 4px;
}

/* Colores por desempe√±o (solo borde/brillo de la foto) */
.perfCard.perf-excellent img {
  border-color: #00ff9d;
  box-shadow: 0 0 14px rgba(0,255,157,0.9);
}

.perfCard.perf-good img {
  border-color: #5dd9ff;
  box-shadow: 0 0 14px rgba(93,217,255,0.9);
}

.perfCard.perf-bad img {
  border-color: #ffd54a;
  box-shadow: 0 0 14px rgba(255,213,74,0.9);
}

.perfCard.perf-awful img {
  border-color: #ff3b6b;
  box-shadow: 0 0 14px rgba(255,59,107,0.9);
}

    /* Ganadora del reto */
    .winnerCard {
      text-align: center;
      padding-top: 10px;
    }

    .winnerCard img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.9);
      margin-bottom: 10px;
    }

    .winnerTitle {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 4px;
    }

    /* Lip sync */
    .lipSyncGrid {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .lipSyncRow {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 18px rgba(0,0,0,0.7);
    }

    .lipSyncRow img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #ff69b4;
      box-shadow: 0 0 14px rgba(255,105,180,0.9);
    }

    /* Eliminada */
    .eliminationWrapper {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 6px;
    }

    .safeQueen, .outQueen {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .safeQueen img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #00ff9d;
      box-shadow: 0 0 18px rgba(0,255,157,0.9);
    }

    .outQueen img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ff0037;
      box-shadow: 0 0 18px rgba(255,0,55,0.9);
      filter: grayscale(100%);
    }

    .outLabel {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #ff8fa8;
    }

    /* Bot√≥n siguiente */
    #nextBtn {
      font-size: 1.1em;
      padding: 12px 20px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      background: linear-gradient(135deg, #ff37b3, #ff70d6);
      color: white;
      font-weight: bold;
      text-shadow: 0 0 8px rgba(255,255,255,0.8);
      box-shadow: 0 0 18px rgba(255, 20, 147, 0.85),
                  0 0 38px rgba(255, 20, 147, 0.6);
      transition: transform 0.18s ease, box-shadow 0.2s ease, opacity 0.2s;
      backdrop-filter: blur(6px);
      margin: 18px auto 0;
      display: block;
      width: 80%;
      max-width: 260px;
    }

    #nextBtn:hover {
      transform: scale(1.04);
      box-shadow: 0 0 28px rgba(255, 20, 147, 1),
                  0 0 60px rgba(255, 20, 147, 0.8);
    }

    #nextBtn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    #episodeContent {
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="sim-panel">
    <h1 id="episodeTitle"></h1>
    <p id="episodeSubtitle"></p>

    <div id="episodeContent"></div>

    <button id="nextBtn">La m√°s‚Ä¶</button>
  </div>

  <script>
    // =========================
    //   RETOS POR TEMPORADA
    // =========================
    const challengesBySeason = {
      "1": [
        "La m√°s diva",
        "La m√°s quincea√±era",
        "La m√°s Thal√≠a",
        "La m√°s Alebrije",
        "La m√°s dram√°tica"
      ],
      "2": [
        "La m√°s t√≠pica",
        "La m√°s religiosa",
        "La m√°s luchona",
        "La m√°s pi√±ata",
        "La m√°s Juanga",
        "La m√°s independiente",
        "La m√°s villana"
      ],
      "3": [
        "La m√°s suertuda",
        "La m√°s prehisp√°nica",
        "La m√°s fichera",
        "La m√°s Chespirito",
        "La m√°s famosa",
        "La m√°s legendaria",
        "La m√°s bella se√±orita M√©xico",
        "La m√°s buchona",
        "La m√°s antojable"
      ],
      "4": [
        "La m√°s folcl√≥rica",
        "La m√°s pintada",
        "La m√°s revolucionaria",
        "La m√°s mezclilla",
        "La m√°s cachuda",
        "La m√°s famosa",
        "La m√°s rosa mexicano",
        "La m√°s chola",
        "La m√°s Cri Cri",
        "La m√°s imperial"
      ],
      "5": [
        "La m√°s artesanal",
        "La m√°s a color",
        "La m√°s juguete",
        "La m√°s famosa",
        "La m√°s del Toro",
        "La m√°s tejocote",
        "La m√°s futurista",
        "La m√°s Lele",
        "La m√°s monja coronada"
      ],
      "6": [
        "La m√°s monumental",
        "La m√°s Frida",
        "La m√°s Pixar",
        "La m√°s recursiva",
        "La m√°s floral",
        "La m√°s nahual",
        "La m√°s azul peltre",
        "La m√°s animada",
        "La m√°s divina Infantita",
        "La m√°s galardonada"
      ],
      "7": [
        "La m√°s Guelaguetza",
        "La m√°s Silvia Pinal",
        "La m√°s dulce",
        "La m√°s recursiva",
        "La m√°s metrera",
        "La m√°s plicop√∫rpura",
        "La m√°s panzuda",
        "La m√°s ma√≠z",
        "La m√°s Lupita"
      ]
    };

    const specialChallenges = {
      reunion: "D√≠a de Muertas",
      final:   "La Gran Final"
    };

    // Lista global de retos
    const allChallenges = [];
    for (const season in challengesBySeason) {
      challengesBySeason[season].forEach((name, index) => {
        allChallenges.push({
          id: `T${season}-${index + 1}`,
          name,
          season
        });
      });
    }
    allChallenges.push(
      { id: "SPECIAL-reunion", name: specialChallenges.reunion, season: "all", type: "reunion" },
      { id: "SPECIAL-final",   name: specialChallenges.final,   season: "all", type: "final" }
    );

    const usedChallengeIds = [];

    function getRandomChallenge() {
      const disponibles = allChallenges.filter(ch => !usedChallengeIds.includes(ch.id));
      if (!disponibles.length) return null;
      const randomIndex = Math.floor(Math.random() * disponibles.length);
      const reto = disponibles[randomIndex];
      usedChallengeIds.push(reto.id);
      return reto;
    }

    // =========================
    //   DATOS DEL CAST
    // =========================
    const cast   = JSON.parse(localStorage.getItem("lmd_selectedQueens") || "[]");
    const config = JSON.parse(localStorage.getItem("lmd_seasonConfig") || "{}");
    // Reinas que siguen en competencia
let aliveQueens = cast.slice();

// Track record: { nombre: ["La +", "Salvada", ...] }
const trackRecord = {};
let episodeNumber = 1;

    const episodeTitleEl    = document.getElementById("episodeTitle");
    const episodeSubtitleEl = document.getElementById("episodeSubtitle");
    const episodeContentEl  = document.getElementById("episodeContent");
    const nextBtn           = document.getElementById("nextBtn");

    if (!cast.length) {
      episodeTitleEl.textContent = "No hay cast cargado";
      episodeSubtitleEl.textContent = "Vuelve a la pantalla inicial y selecciona tus femininosas ‚ú®";
      episodeContentEl.textContent = "";
      nextBtn.disabled = true;
    }

    // =========================
    //   EPISODIO 1 ALEATORIO
    // =========================
    const performanceLabels = {
      excellent: "tuvo un excelente desempe√±o",
      good:      "tuvo un buen desempe√±o",
      bad:       "tuvo un mal desempe√±o",
      awful:     "tuvo un p√©simo desempe√±o"
    };
    // Reinas que siguen en competencia
let aliveQueens = cast.slice();

// Track record: { nombre: ["La +", "Salvada", ...] }
const trackRecord = {};
let episodeNumber = 1;

const episodeTitleEl    = document.getElementById("episodeTitle");
const episodeSubtitleEl = document.getElementById("episodeSubtitle");
const episodeContentEl  = document.getElementById("episodeContent");
const nextBtn           = document.getElementById("nextBtn");

if (!cast.length) {
  episodeTitleEl.textContent = "No hay cast cargado";
  episodeSubtitleEl.textContent = "Vuelve a la pantalla inicial y selecciona tus femininosas ‚ú®";
  episodeContentEl.textContent = "";
  nextBtn.disabled = true;
}

// =========================
//   EPISODIO ALEATORIO
// =========================
const performanceLabels = {
  excellent: "tuvo un excelente desempe√±o",
  good:      "tuvo un buen desempe√±o",
  bad:       "tuvo un mal desempe√±o",
  awful:     "tuvo un p√©simo desempe√±o"
};

// -1 -> suspense / 0 -> desempe√±o / 1 -> top & bottom / 2 -> winner / 3 -> lipsync / 4 -> eliminaci√≥n / 5 -> track
let currentEpisode = null;
let step = -1;

    function buildEpisode() {
  const challenge = getRandomChallenge() || { id: "fallback", name: "La Gran Final" };

    // Barajamos solo a las que siguen en competencia
  const shuffled = aliveQueens.slice().sort(() => Math.random() - 0.5);
  const n = shuffled.length;

  if (n === 0) return;

  // --- Elegimos √≠ndices al azar para cada rol ---
  const indexes = [...Array(n).keys()]; // [0,1,2,...]

  function drawIndex() {
    const pos = Math.floor(Math.random() * indexes.length);
    return indexes.splice(pos, 1)[0]; // quita y devuelve un √≠ndice
  }

  // Ganadora
  const winnerIdx = drawIndex();

  // Dos tops adicionales (si hay suficiente cast)
  const topIdxs = [];
  if (n >= 4) topIdxs.push(drawIndex());
  if (n >= 5) topIdxs.push(drawIndex());

  // Dos para lip sync
  const lipIdxs = [];
  if (n >= 3) lipIdxs.push(drawIndex());
  if (n >= 4) lipIdxs.push(drawIndex());

  // Una extra para estar en las "menos" pero sin lip sync (si hay varias)
  let extraBottomIdx = null;
  if (n >= 6 && indexes.length > 0) {
    extraBottomIdx = drawIndex();
  }

  // Un par de "low" (mal desempe√±o) si sobran reinas
  const lowIdxs = [];
  if (indexes.length > 0) {
    const numLow = Math.min(2, indexes.length);
    for (let i = 0; i < numLow; i++) {
      lowIdxs.push(drawIndex());
    }
  }
  // Lo que quede en indexes se considerar√° "buen desempe√±o" normal

    // --- Construimos la lista de performances ---
  const performances = [];

  for (let i = 0; i < n; i++) {
    const q = shuffled[i];
    let perfType = "good";      // tipo para la pantalla del episodio
    let trackMark = "Salvada";  // marca para el track record

    if (i === winnerIdx) {
      perfType  = "excellent";
      trackMark = "La +";
    } else if (topIdxs.includes(i)) {
      perfType  = "good";
      trackMark = "La casi +";
    } else if (lipIdxs.includes(i)) {
      perfType  = "awful";
      trackMark = "La -";
    } else if (i === extraBottomIdx || lowIdxs.includes(i)) {
      perfType  = "bad";
      trackMark = "La casi -";
    } else {
      perfType  = "good";
      trackMark = "Salvada";
    }

    performances.push({
      queen: q,
      type: perfType,
      text: performanceLabels[perfType],
      track: trackMark
    });

    // Guardar en trackRecord (una casilla por episodio)
    if (!trackRecord[q.name]) {
      trackRecord[q.name] = [];
    }
    trackRecord[q.name].push(trackMark);
  }
  // --- Tops y bottoms para las otras pantallas ---
  const tops = [shuffled[winnerIdx], ...topIdxs.map(i => shuffled[i])];
  const bottoms = [...lipIdxs.map(i => shuffled[i])];
  if (extraBottomIdx !== null) bottoms.push(shuffled[extraBottomIdx]);

  const lipsyncPair = lipIdxs.map(i => shuffled[i]);
  let eliminated, safeFromLipsync;

  if (lipsyncPair.length === 2) {
    eliminated = Math.random() < 0.5 ? lipsyncPair[0] : lipsyncPair[1];
    safeFromLipsync = eliminated === lipsyncPair[0] ? lipsyncPair[1] : lipsyncPair[0];
  } else if (lipsyncPair.length === 1) {
    // por si hubiera cast muy peque√±o
    eliminated = lipsyncPair[0];
    safeFromLipsync = null;
  } else {
    eliminated = null;
    safeFromLipsync = null;
  }

  currentEpisode = {
    challenge,
    performances,
    tops,
    bottoms,
    winner: shuffled[winnerIdx],
    lipsyncPair,
    eliminated,
    safeFromLipsync
  };
}

    // =========================
    //   RENDER DE CADA FASE
    // =========================
    function renderPerformanceList() {
  episodeContentEl.innerHTML = "";

  const title = document.createElement("h2");
  title.className = "sectionTitle";
  title.textContent = "Desempe√±o del cast";
  episodeContentEl.appendChild(title);

  // Agrupamos por tipo de desempe√±o
  const grouped = {
    excellent: [],
    good:      [],
    bad:       [],
    awful:     []
  };

  currentEpisode.performances.forEach(item => {
    grouped[item.type].push(item);
  });

  const order = [
    { key: "excellent", label: "Excelente desempe√±o" },
    { key: "good",      label: "Buen desempe√±o" },
    { key: "bad",       label: "Mal desempe√±o" },
    { key: "awful",     label: "P√©simo desempe√±o" }
  ];

  order.forEach(({ key, label }) => {
    const list = grouped[key];
    if (!list.length) return;

    // T√≠tulo del grupo
    const h3 = document.createElement("h3");
    h3.className = "miniTitle";
    h3.textContent = label;
    episodeContentEl.appendChild(h3);

    // Grupo de filas
    const groupDiv = document.createElement("div");
    groupDiv.className = "perfGroup";

    list.forEach(item => {
      const row = document.createElement("div");
      row.className = `episodeRow perf-${item.type}`;

      row.innerHTML = `
        <img src="${item.queen.image}" alt="${item.queen.name}">
        <div class="episodeText">
          <span class="episodeName">${item.queen.name} (T${item.queen.season})</span>
          <span class="episodePerf">${item.text}</span>
        </div>
      `;
      groupDiv.appendChild(row);
    });

    episodeContentEl.appendChild(groupDiv);
  });
}
  
    function renderTopBottom() {
      episodeContentEl.innerHTML = "";

      const topTitle = document.createElement("h2");
      topTitle.className = "sectionTitle";
      topTitle.textContent = "Las m√°s";
      episodeContentEl.appendChild(topTitle);

      currentEpisode.tops.forEach(q => {
        const row = document.createElement("div");
        row.className = "episodeRow perf-excellent";
        row.innerHTML = `
          <img src="${q.image}" alt="${q.name}">
          <div class="episodeText">
            <span class="episodeName">${q.name} (T${q.season})</span>
            <span class="episodePerf">Entre las mejores del episodio</span>
          </div>
        `;
        episodeContentEl.appendChild(row);
      });

      const lowTitle = document.createElement("h2");
      lowTitle.className = "sectionTitle";
      lowTitle.textContent = "Las menos";
      episodeContentEl.appendChild(lowTitle);

      currentEpisode.bottoms.forEach(q => {
        const row = document.createElement("div");
        row.className = "episodeRow perf-awful";
        row.innerHTML = `
          <img src="${q.image}" alt="${q.name}">
          <div class="episodeText">
            <span class="episodeName">${q.name} (T${q.season})</span>
            <span class="episodePerf">Entre las peores del episodio</span>
          </div>
        `;
        episodeContentEl.appendChild(row);
      });
    }

    function renderWinner() {
      episodeContentEl.innerHTML = "";

      const card = document.createElement("div");
      card.className = "winnerCard";

      const retoNombre = currentEpisode.challenge.name;
      let clean = retoNombre.replace(/^La m√°s\s*/i, "");
      if (!clean) clean = retoNombre;

      card.innerHTML = `
        <div class="winnerTitle">La m√°s ${clean} es‚Ä¶</div>
        <img src="${currentEpisode.winner.image}" alt="${currentEpisode.winner.name}">
        <div class="episodeName">${currentEpisode.winner.name} (T${currentEpisode.winner.season})</div>
      `;

      episodeContentEl.appendChild(card);
    }

    function renderLipsync() {
      episodeContentEl.innerHTML = "";

      const title = document.createElement("h2");
      title.className = "sectionTitle";
      title.textContent = "Doblaje por la corona";
      episodeContentEl.appendChild(title);

      const info = document.createElement("p");
      info.textContent = "Las menos se enfrentan en un lip sync por su vida.";
      info.style.margin = "0 0 8px";
      episodeContentEl.appendChild(info);

      const grid = document.createElement("div");
      grid.className = "lipSyncGrid";

      currentEpisode.lipsyncPair.forEach(q => {
        const row = document.createElement("div");
        row.className = "lipSyncRow";
        row.innerHTML = `
          <img src="${q.image}" alt="${q.name}">
          <div class="episodeText">
            <span class="episodeName">${q.name} (T${q.season})</span>
            <span class="episodePerf">Doblaje de eliminaci√≥n</span>
          </div>
        `;
        grid.appendChild(row);
      });

      episodeContentEl.appendChild(grid);
    }

    function renderElimination() {
      episodeContentEl.innerHTML = "";

      const title = document.createElement("h2");
      title.className = "sectionTitle";
      title.textContent = "Resultado del doblaje";
      episodeContentEl.appendChild(title);

      const wrap = document.createElement("div");
      wrap.className = "eliminationWrapper";

      const safe = document.createElement("div");
      safe.className = "safeQueen";
      safe.innerHTML = `
        <img src="${currentEpisode.safeFromLipsync.image}" alt="${currentEpisode.safeFromLipsync.name}">
        <div class="episodeName">${currentEpisode.safeFromLipsync.name} (T${currentEpisode.safeFromLipsync.season})</div>
        <div class="episodePerf">Sigue en la competencia</div>
      `;

      const out = document.createElement("div");
      out.className = "outQueen";
      out.innerHTML = `
        <img src="${currentEpisode.eliminated.image}" alt="${currentEpisode.eliminated.name}">
        <div class="outLabel">Abandona la competencia</div>
        <div class="episodeName">${currentEpisode.eliminated.name} (T${currentEpisode.eliminated.season})</div>
      `;

      wrap.appendChild(safe);
      wrap.appendChild(out);
      episodeContentEl.appendChild(wrap);
    }
            // =========================
    //   TRACK RECORD
    // =========================
    function renderTrackRecord() {
      episodeContentEl.innerHTML = "";

      const title = document.createElement("h2");
      title.className = "sectionTitle";
      title.textContent = "Track record de la temporada";
      episodeContentEl.appendChild(title);

      // Encabezado tipo tabla
      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.justifyContent = "space-between";
      header.style.fontSize = "0.8rem";
      header.style.opacity = "0.9";
      header.style.marginBottom = "6px";
      header.innerHTML = `
        <span>Feminosa</span>
        <span>Episodio ${episodeNumber}</span>
      `;
      episodeContentEl.appendChild(header);

      const table = document.createElement("div");
      table.style.display = "flex";
      table.style.flexDirection = "column";
      table.style.gap = "6px";

      // Mostramos TODAS las reinas (aunque ya est√©n eliminadas)
      cast.forEach(q => {
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.alignItems = "center";
        row.style.gap = "8px";

        const marks = trackRecord[q.name] || [];
        const mark = marks[episodeNumber - 1] || "‚Äî";

        row.innerHTML = `
          <img src="${q.image}" alt="${q.name}" style="
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ff69b4;
            box-shadow: 0 0 8px rgba(255,105,180,0.8);
          ">
          <span style="flex:1;font-size:0.85rem;">${q.name}</span>
          <span style="
            min-width: 90px;
            text-align: center;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(0,0,0,0.55);
            box-shadow: 0 0 10px rgba(0,0,0,0.7);
          ">
            ${mark}
          </span>
        `;
        table.appendChild(row);
      });

      episodeContentEl.appendChild(table);
    }
function renderStep() {
  if (!currentEpisode) return;

  const retoNombre = currentEpisode.challenge.name;

  switch (step) {
    case -1:
      episodeTitleEl.textContent = "La m√°s‚Ä¶";
      episodeSubtitleEl.textContent = "Pulsa para revelar el reto del episodio";
      nextBtn.textContent = "Revelar reto";
      episodeContentEl.innerHTML = "";
      break;

    case 0:
      episodeTitleEl.textContent = retoNombre;
      episodeSubtitleEl.textContent = "Desempe√±o del episodio";
      nextBtn.textContent = "Las m√°s y las menos";
      renderPerformanceList();
      break;

    case 1:
      episodeTitleEl.textContent = retoNombre;
      episodeSubtitleEl.textContent = "Las m√°s y las menos del reto";
      nextBtn.textContent = "Revelar a la m√°s‚Ä¶";
      renderTopBottom();
      break;

    case 2:
      episodeTitleEl.textContent = retoNombre;
      episodeSubtitleEl.textContent = "";
      nextBtn.textContent = "Ver lip sync";
      renderWinner();
      break;

    case 3:
      episodeTitleEl.textContent = retoNombre;
      episodeSubtitleEl.textContent = "Doblaje por su vida";
      nextBtn.textContent = "Resultado del doblaje";
      renderLipsync();
      break;

    case 4:
      episodeTitleEl.textContent = retoNombre;
      episodeSubtitleEl.textContent = "";
      nextBtn.textContent = "Track record";
      renderElimination();
      break;

    case 5:
      episodeTitleEl.textContent = "Track record de la temporada";
      episodeSubtitleEl.textContent = "Resumen hasta este episodio";
      nextBtn.textContent = aliveQueens.length > 4
        ? "Siguiente episodio"
        : "Ir a la Gran Final";
      renderTrackRecord();
      break;

    case 6:
      // Aqu√≠, al tener 4 queens, iniciaremos la FINAL (Paso 2 üòà)
      startFinale();
      break;
  }
}

nextBtn.addEventListener("click", () => {
  if (!cast.length) return;

  if (step === 4 && currentEpisode.eliminated) {
    aliveQueens = aliveQueens.filter(q => q.name !== currentEpisode.eliminated.name);
  }

  if (step === 5) {
    if (aliveQueens.length > 4) {
      episodeNumber++;
      buildEpisode();
      step = -1;
      renderStep();
      return;
    } else {
      step = 6; // Pasamos a la final
      renderStep();
      return;
    }
  }

  step++;
  renderStep();
});
 </script>
</body>
  </html>
