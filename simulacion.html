<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Episodio - La M√°s Draga</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
/* =========================
   üé® ESTILOS ORIGINALES
========================= */
body {
  margin: 0;
  font-family: 'Arial', sans-serif;
  min-height: 100vh;
  background-image: url('WhatsApp Image 2025-12-01 at 07.24.11.jpeg');
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center top;
  color: white;
  overflow-x: hidden;
  padding: env(safe-area-inset-top) 10px 30px;
  box-sizing: border-box;
}

.sim-panel {
  max-width: 430px;
  margin: 70px auto 40px;
  padding: 18px 18px 24px;
  background: rgba(0, 0, 0, 0.40);
  border-radius: 26px;
  backdrop-filter: blur(18px);
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.75);
}

h1 {
  margin: 0 0 8px;
  font-size: 2rem;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  background: linear-gradient(90deg, #ffd700, #ff69b4, #7b5dff);
  -webkit-background-clip: text;
  color: transparent;
}

#episodeSubtitle {
  text-align: center;
  font-size: 0.95rem;
}

.sectionTitle {
  font-size: 1.15rem;
  text-transform: uppercase;
  margin: 14px 0 8px;
}

.episodeRow {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 4px 0;
}

.episodeRow img {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid #ff69b4;
}

.miniTitle {
  margin-top: 12px;
  text-transform: uppercase;
}

.winnerCard img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  border: 4px solid gold;
}

.lipSyncRow {
  display: flex;
  gap: 10px;
  padding: 8px;
}

.safeQueen img, .outQueen img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
}

.outQueen img {
  filter: grayscale(100%);
  border-color: red;
}

#nextBtn {
  margin: 18px auto 0;
  display: block;
  width: 80%;
  padding: 12px;
  font-size: 1.1em;
  border-radius: 16px;
  border: none;
  background: #ff37b3;
  color: white;
}
</style>
</head>
<body>

<div class="sim-panel">
  <h1 id="episodeTitle">La m√°s‚Ä¶</h1>
  <p id="episodeSubtitle">Pulsa para revelar el reto del episodio</p>
  <div id="episodeContent"></div>
  <button id="nextBtn">Revelar reto</button>
</div>

<script>
// =========================
// RETOS
// =========================
const challengesBySeason = {
"1": ["La m√°s diva","La m√°s quincea√±era","La m√°s Thal√≠a","La m√°s Alebrije","La m√°s dram√°tica"],
"2": ["La m√°s t√≠pica","La m√°s religiosa","La m√°s luchona","La m√°s pi√±ata","La m√°s Juanga","La m√°s independiente","La m√°s villana"],
"3": ["La m√°s suertuda","La m√°s prehisp√°nica","La m√°s fichera","La m√°s Chespirito","La m√°s famosa","La m√°s legendaria","La m√°s bella se√±orita M√©xico","La m√°s buchona","La m√°s antojable"],
"4": ["La m√°s folcl√≥rica","La m√°s pintada","La m√°s revolucionaria","La m√°s mezclilla","La m√°s cachuda","La m√°s famosa","La m√°s rosa mexicano","La m√°s chola","La m√°s Cri Cri","La m√°s imperial"],
"5": ["La m√°s artesanal","La m√°s a color","La m√°s juguete","La m√°s famosa","La m√°s del Toro","La m√°s tejocote","La m√°s futurista","La m√°s Lele","La m√°s monja coronada"],
"6": ["La m√°s monumental","La m√°s Frida","La m√°s Pixar","La m√°s recursiva","La m√°s floral","La m√°s nahual","La m√°s azul peltre","La m√°s animada","La m√°s divina Infantita","La m√°s galardonada"],
"7": ["La m√°s Guelaguetza","La m√°s Silvia Pinal","La m√°s dulce","La m√°s recursiva","La m√°s metrera","La m√°s plicop√∫rpura","La m√°s panzuda","La m√°s ma√≠z","La m√°s Lupita"]
};

const specialFinal = "La Gran Final";

// =========================
// CAST
// =========================
const cast = JSON.parse(localStorage.getItem("lmd_selectedQueens") || "[]");
let aliveQueens = [...cast];
const trackRecord = {};

let episodeNumber = 1;
let step = -1;
let currentEpisode = null;

if (!cast.length) {
document.getElementById("episodeTitle").textContent = "Sin cast";
document.getElementById("nextBtn").disabled = true;
}

// =========================
// ALEATORIEDAD
// =========================
function randomChoice(arr) {
return arr[Math.floor(Math.random() * arr.length)];
}

// =========================
// CONSTRUIR EPISODIO
// =========================
function buildEpisode() {
const season = randomChoice(Object.keys(challengesBySeason));
const challenge = randomChoice(challengesBySeason[season]);

const shuffled = [...aliveQueens].sort(() => Math.random() - 0.5);
const winner = shuffled[0];
const bottoms = shuffled.slice(-2);

bottoms.forEach(q => {
if (!trackRecord[q.name]) trackRecord[q.name] = [];
trackRecord[q.name].push("La -");
});

if (!trackRecord[winner.name]) trackRecord[winner.name] = [];
trackRecord[winner.name].push("La +");

currentEpisode = {
  challenge,
  winner,
  bottoms,
  eliminated: randomChoice(bottoms)
};
}

// =========================
// RENDER
// =========================
function render() {
const content = document.getElementById("episodeContent");
const title = document.getElementById("episodeTitle");
const subtitle = document.getElementById("episodeSubtitle");
const btn = document.getElementById("nextBtn");

switch (step) {
case -1:
  title.textContent = "La m√°s‚Ä¶";
  subtitle.textContent = "Pulsa para revelar el reto del episodio";
  content.innerHTML = "";
  btn.textContent = "Revelar reto";
  break;

case 0:
  title.textContent = currentEpisode.challenge;
  subtitle.textContent = "Desempe√±o del episodio";
  content.innerHTML =
    `<div class="sectionTitle">La ganadora</div>
    <div class="episodeRow"><img src="${currentEpisode.winner.image}">
      <span>${currentEpisode.winner.name}</span></div>`;
  btn.textContent = "Doblaje";
  break;

case 1:
  title.textContent = currentEpisode.challenge;
  subtitle.textContent = "Doblaje por la vida";
  content.innerHTML = currentEpisode.bottoms.map(q =>
    `<div class="episodeRow"><img src="${q.image}"><span>${q.name}</span></div>`).join("");
  btn.textContent = "Resultado";
  break;

case 2:
  title.textContent = currentEpisode.challenge;
  subtitle.textContent = "";
  content.innerHTML =
    `<div class="sectionTitle">Eliminada</div>
    <div class="outQueen">
    <img src="${currentEpisode.eliminated.image}">
    <span>${currentEpisode.eliminated.name}</span>
    </div>`;
  btn.textContent = "Track Record";
  break;

case 3:
  aliveQueens = aliveQueens.filter(q => q !== currentEpisode.eliminated);
  title.textContent = "Track Record";
  subtitle.textContent = "Resumen hasta ahora";
  content.innerHTML =
    aliveQueens.map(q => `<div class="episodeRow"><img src="${q.image}">
    <span>${q.name}</span>
    </div>`).join("");
  btn.textContent = aliveQueens.length > 4
    ? "Siguiente episodio"
    : "Gran Final";
  break;

case 4:
  runFinal();
  break;
}
}

// =========================
// FINAL
// =========================
function runFinal() {
const content = document.getElementById("episodeContent");

let winner = randomChoice(aliveQueens);

document.getElementById("episodeTitle").textContent = specialFinal;
document.getElementById("episodeSubtitle").textContent = "Ganadora de la temporada";
content.innerHTML =
  `<div class="winnerCard">
  <img src="${winner.image}">
  <div class="episodeName">${winner.name}</div>
  </div>`;

document.getElementById("nextBtn").textContent = "Volver al inicio";
document.getElementById("nextBtn").onclick = () => {
  window.location.href = "index.html";
};
}

// =========================
// CLICK
// =========================
document.getElementById("nextBtn").onclick = () => {
if (step === -1) buildEpisode();
else if (step === 3) episodeNumber++;
step++;
render();
};
render();
</script>

</body>
</html>
